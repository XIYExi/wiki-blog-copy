---
title: String
---

import TH from "@site/src/components/TextHighlight/index.js";

## 模版字面量标签函数

模版字面量支持定义<TH>标签函数</TH>，而通过标签函数可以自定义插值行为。标签函数会接收<TH>被插值记号分隔后的模板</TH>和<TH>对每个表达式求值的结果</TH>。

```javascript {13} title="simpleTag.js" showLineNumbers
let a = 9;
let b = 20;

function simpleTag(strings, aValExpression, bValExpression, sumExpression) {
  console.log(strings);
  console.log(aValExpression);
  console.log(bValExpression);
  console.log(sumExpression);
  return "result";
}

let untaggedResult = `${a} + ${b} = ${a + b}`;
let taggedResult = simpleTag`${a} + ${b} = ${a + b}`;
// expected:
// ["", " + ", " = ", ""]
// 9
// 20
// 29
console.log(untaggedResult); // expected: "9 + 20 = 29"
console.log(taggedResult); // expected: "result"
```

标签函数的第一个参数为<TH>模板参数</TH>和<TH>边界的间隔</TH>组成的数组，即插值符号分隔出的字符串数组。

### 剩余操作符作为参数

由于表达式的参数是**可变**的，所以通常应该使用<TH>剩余操作符</TH>将它们收集到一个数组中：

```javascript {1} title="simpleTag.js" showLineNumbers
function simpleTag(string, ...expressions) {
  console.log(string);
  for (const expression of expressions) {
    console.log(expression);
  }
  return "result";
}
```

### 默认返回字符串

因为参数始终是 **n** 个，而传给标签函数第一个参数所包含的字符串数始终是 **n + 1** 个，把字符串和插值符号的计算结果拼接起来，可以得到默认返回字符串：

```javascript title="simpleTag.js" showLineNumbers
function zipTag(strings, ...expressions) {
  return (
    strings[0] + expressions.map((e, i) => `${e}${strings[i + 1]}`).join("")
  );
}
```

### 原始字符串

使用默认的标签函数 `String.raw`，可以直接获取原始的模板字面量内容（如**换行符**或 **Unicode 字符**），而不是被转换后的字符表示。

```javascript
console.log(`\u00A9`); // expected: ©
console.log(String.raw`\u00A9`); // expected: \u00A9

console.log(`First Line\nSecond Line`);
// expected:
// First Line
// Second Line
console.log(String.raw`First Line\nSecond Line`);
// expected: First Line\nSecond Line

console.log(`First Line
Second Line`);
// expected:
// First Line
// Second Line
console.log(String.raw`First Line
Second Line`);
// expected:
// First Line
// Second Line
```

:::caution 注意
对实际的换行符来说是不行的，它们不会被转换成转义序列的形式。
:::
